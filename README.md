<!-- -*- coding: utf-8 -*- -->

※ 「のです」調になっています。ご注意を。

C 版 Friends
============

Friends 言語をもっといろいろな環境で実行させたかったのです。

* [オリジナル版](https://github.com/vain0/VainZero.Friends)

文法
----

文法はほとんどオリジナル版と同じなのです。

違う（と思われる）ところは以下の通りなのです。

* 「すごーい！」「たーのしー！」 の「ー」は全角ダッシュも許してやるの
  です。
* 「すごーい！」「たーのしー！」「なんだね！」「なんだっけ？」の「！」
  「？」は半角でも許してやるのです。
* 「すこ゛ーい！」のように「゛」が分離してしまっていても許してやるので
  す（普通に入力しているはずなのにデータ上ではこのようになってしまう環
  境があるらしいのです）。ただし、アトムでは異なるものとして扱うのです
  （例：「サーバル」と「サーハ゛ル」は別物）。
* 単語間のスペースは、半角スペース、全角スペースの他にも「，」「、」
  （半角全角問わず）を許してやるのです。
* 「なら」「で」を普通の助詞に使えるのです。（例: `すごーい！ あなた 
  が ヒトの フレンズ で、かのじょ が サーバルの フレンズ なら、あなた 
  と かのじょ で ○○できる フレンズ なんだね！`）
* 変数の頭につける「_」は全角でも許してやるのです。
* 予約されている名前に「_」をつけた変数（例: 「_あなた」）と予約されて
  いる名前（この例の場合は、「あなた」）を区別しないのです。
* 「あなた」「きみ」「かれ」「かのじょ」「だれ」「なに」「あれ」「これ」
  「これら」「それ」「それら」の他に「ここ」「そこ」「あそこ」「どこ」
  「どれ」を予約済み変数名にしているのです。
* 予約済み変数名の「゛」が分離してしまっていても変数として扱うのです。
  ただし、「かのじょ」と「かのし゛ょ」は別の変数として扱うのです。
* 「つぎ」「つき゛」は「次」と同じアトムとして扱うのです。
* 変数として扱われる名前は、フレンズの名前にすることはできないのです
  （例：× `かばんちゃん は なに フレンズ なんだっけ？`）。ちなみに `か
  ばんちゃん は 何の フレンズ なんだっけ？` は文法上は誤りでは無いけど
  「何の」に当てはまるものを検索することは無いのです。
* 自然数のアトムは、全角で書かれていても許してやるのです。
  （例：`すごーい！ ０ は 自然数の フレンズ なんだね！`）

* アトムと変数の名前には、コントロール文字（U+0000〜U+001F と U+FFF0〜
  U+FFFF）を含まない文字列ならなんでも使えるのです。ただし、区切りにな
  る文字（スペース、カンマとカッコなど）を含めたり、キーワードと同じ文
  字列を使いたければ（）か、『』でくくるのです。同じ記号での入れ子はで
  きないのです。（）は半角でも良いのです。（例：`だれ が『たーの
  しー！』って 言った フレンズ なんだっけ？`）

ビルド
------

ビルドには、

* [CMake](http://www.cmake.org) 2.8.12 以降
* [re2c](http://re2c.org) 0.16 以降
* [lemon](https://www.hwaci.com/sw/lemon/)
* 64 bit の環境で、4 GB 以上のメモリ
 
が必要なのです。

C の標準ライブラリさえ使えればわりとどんなところでも実行できるのです。
ただし、日本語を表示したり入力したりできる環境は必要なのです。

手元で確認したコンパイル環境は以下の通りなのです。

* gcc 7.1.1 (Linux)
* gcc 4.8.5 (Linux)
* gcc 6.3.0 (Windows, MSYS2)
* gcc 7.2.1 (Windows, MinGW64)
* Apple clang 802.0.42 (macOS 10.12)
* Visual Studio 2017 (Windows)
<!-- * gcc 6.4.0 (DOS, DJGPP) -->

ビルドに挑戦するフレンズにちょっとアドバイスなのです。C 版 Friends で
は、文字コードの変換をとっても強引な方法で実装しているので、メモリをた
くさん使うのです（3 GB 以上）。そして、最適化をかけるとコンパイルに負
荷がかかるのです（手元のそこそこ速い環境でも5分ぐらい）。待ちきれない
時は、最適化レベルを下げるか、UTF-8 だけ使うことにして Shift_JIS
(Windows の文字コード) と EUC-JP （古い UNIX 用の文字コード）のサポー
トを切ってしまうと良いのです。

32 bit の環境だったり、メモリが 4 GB 未満しか無い時は、UTF-8 の文字コー
ドだけ使うことにすれば、コンパイルできると思うのです。でも、これでは
Windows ではちょっと不便なのです。

### CMake オプション



### re2c のビルド

われわれは、親切なので、一応書いておくのです。re2c のビルドには、C++
のコンパイラが必要なのです。Windows でビルドする場合は、MSYS2 の環境を
用意するのです。

~~~~~
 $ ./configure --prefix=[インストール先]
 $ make
 $ make install
~~~~~

MSYS2 の環境を使う時は以下のコマンドで、必要なものをまとめてインストー
ルできるのです。

~~~~~
 $ pacman -Sy gcc g++ make cmake
~~~~~

### lemon のコンパイル

こちらはコンパイルは簡単なのです。

~~~~~
 $ gcc -o lemon lemon.c
~~~~~

